# Веб-сервис "Ассистент по языку запросов 1С:Предприятие 8"

## Описание

Программа разработана для помощи продвинутым аналитикам в создании запросов на платформе 1С:Предприятие 8.

Решаемые задачи:
  - Интеграция, позволяющая пользователям работать из привычного интерфейса 1С:Предприятие 8.
  - Предоставление ИИ-агенту контекста для создания текста запроса: список и описание таблиц информационной базы.
  - Уведомление ИИ-агента о результатах проверки синтаксиса запроса.

Интеллектуальным агентом в текущей версии выступает модель **GigaChat**.
 
Доступно три варианта работы:
  - **Веб-сервис**. Подразумевается интеграция с внешней обработкой "Консоль запросов" или любым подобным инструментом;
  - **Работа в консоли**. Работа выполняется в командной строке. Режим удобен для тестирования и отладки;
  - **Загрузка метаданных**. Производится загрузка описания таблиц информационной базы в базу данных веб-сервиса.
   
Каждый из вариантов может быть запущен в ***режиме отладки*** с выводом отладочной информации в файл лога.

## Использование

### Веб-сервис

Для запуска **веб-сервиса** используйте параметр *start*: ```python main.py start```

**Веб-сервис** предоставляет следующий интерфейс:
  - *Проверка запуска веб-сервиса*. Необходимо отправить GET-запрос по адресу веб-сервиса, например набрать в браузере: ```localhost:8000```.
Работающий **веб-сервис** вернет страницу с надписью ```SQL-assistant works```;
  - *Создание текста запроса*. **Веб-сервис** ожидает описание задачи в формате JSON в теле POST запроса: ```{"prompt": "Описание задачи"}```.
В ответ вернется строка JSON вида: ```{"response": "Текст запроса"}```. Кодировка текста: ```UTF-8```.

### Работа в консоли

Запуск **работы в консоли** выполняется из ***режима отладки*** (см. далее).
Данный вариант работы позволяет ставить задачи на создание текста запроса в текстовом диалоге в формате "вопрос-ответ".

### Загрузка метаданных

Для ***загрузки метаданных*** выполните запуск с параметром *load_md*: ```python main.py load_md```.
Программа загрузит описание таблиц информационной базы из файла метаданных в базу данных **веб-сервиса**.

Формат файла метаданных достаточно свободный и определяется способностью модели работать со структурированной информацией.
Обязательным является только свойство *ИмяОбъекта* в описании каждой таблицы.
Примеры файла метаданных *metadata1.json* и внешней обработки для его формирования *DumpMetadata.epf* включены в репозитарий.

### Режим отладки

Для работы в ***режиме отладки*** программу необходимо запустить без параметров: ```python main.py```.

Из ***режима отладки*** доступен запуск всех вариантов работы.
В данном режиме в файл лога выводится информация, которой обмениваются агенты **веб-сервиса**.

## Установка

## Тестирование

### Тестирование веб-сервиса

Порядок тестирования:
1. В командной строке перейдите в каталог **веб-сервиса**: ```cd <путь к папке веб-сервиса>```;
2. Запустите **веб-сервис**: ```python main.py start```;
3. Проверьте успешность запуска, откройте браузер и наберите: ```localhost:8000```. Вы должны увидеть страницу с надписью ```SQL-assistant works```;
4. Проверьте интерфейс **веб-сервиса** по созданию запросов (см. далле).
	- Если установлена платформа 1С:Предприятие 8, воспользуйтесь внешней обработкой *CheckWebAssistant.epf*;
	- Если "1С" не установлена используйте скрипт *CheckWebAssistant.py*:
		- Откройте новое окно командной строки, окно с **веб-сервисом** должно оставаться открытым;
		- Перейдите в каталог **веб-сервиса**: ```cd <путь к папке веб-сервиса>```;
		- Запустите скрипт: ```python CheckWebAssistant.py```;
		- Введите описание задачи, например: Продажи за неделю с отбором по контрагенту;
		- Ответом должен быть текст запроса на языке платформа 1С:Предприятие 8.
  
### Тестирование в консоли

Порядок тестирования:
  1. Запустите ***режим отладки***: ```python main.py```;
  2. Выберите вариант **Работа в консоли**;
  3. Введите описание задачи, например: Продажи за неделю с отбором по контрагенту;
  4. Ответом должен быть текст запроса на языке платформа 1С:Предприятие 8.

## Настройка
